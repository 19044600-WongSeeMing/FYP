@model Product;

<!DOCTYPE html>
<html>
<head>
    <title>Menu Page</title>
</head>
<body>
    <div class="background">
        <div class=" menuAlign">
        <h3>Main Dish</h3>
            </div>
    <div class="container">
        <div class="image ">
            <img src="~/FoodPics/ondeh.jpg" />
            <h3>Ondeh Ondeh</h3>
            <h3>$2.00</h3>
            <a class="add-cart cart1" href="#">Add Cart</a>
        </div>
        <div class="image ">
            <img src="~/FoodPics/pulut.jpg" />
            <h3>Pulut Urap</h3>
            <h3>$3.00</h3>
            <a class="add-cart cart2" href="#">Add Cart</a>
        </div>
        <div class="image ">
            <img src="~/FoodPics/nasiPadang.jpg" />
            <h3>Nasi Padang</h3>
            <h3>$7.50</h3>
            <a class="add-cart cart3" href="#">Add Cart</a>
        </div>
        <div class="image ">
            <img src="~/FoodPics/badak.jpg" />
            <h3>Badak Berendam</h3>
            <h3>$3.00</h3>
            <a class="add-cart cart4" href="#">Add Cart</a>
        </div>
        </div>

    </div>
    <script>
        let carts = document.querySelectorAll('.add-cart');

        let products =
            [
                {
                    name: 'Ondeh Ondeh',
                    tag: 'ondeh',
                    price: 2,
                    inCart: 0
                },
                {
                    name: 'Pulut Urap',
                    tag: 'urap',
                    price: 3,
                    inCart: 0
                },
                {
                    name: 'Nasi Padang',
                    tag: 'padang',
                    price: 7.5,
                    inCart: 0
                },
                {
                    name: 'Badak Berendam',
                    tag: 'berendam',
                    price: 3,
                    inCart: 0
                }

            ]


        for (let i = 0; i<carts.length; i++) {
            carts[i].addEventListener('click', () => {
                cartNumbers(products[i]);
                totalCost(products[i]);
            })
        }

        function onLoadCartNum() {
            let prductNumbers = localStorage.getItem('cartNumbers');
            if (prductNumbers) {
                document.querySelector('.cart span').textContent = 1;
            }
        }
        function cartNumbers(product) {
         
            let prductNumbers = localStorage.getItem('cartNumbers');

            prductNumbers = parseInt(prductNumbers);

            if (prductNumbers) {
                localStorage.setItem('cartNumbers', prductNumbers + 1);
                document.querySelector('.cart span').textContent = prductNumbers +1;
            }
            else {
                localStorage.setItem('cartNumbers', 1);
                document.querySelector('.cart span').textContent = 1;
            }
            setItems(product)
            
        }
        function setItems(product) {
            let cartItems = localStorage.getItem('productsInCart');
            cartItems = JSON.parse(cartItems);
            

            if (cartItems != null) {
                if (cartItems[product.tag] == undefined) {
                    cartItems = {
                        ...cartItems, [product.tag]: product
                    }
                }
                cartItems[product.tag].inCart += 1;
            }
            else {
                product.inCart = 1;
                cartItems = {
                    [product.tag]: product
                }
            }

            localStorage.setItem('productsInCart', JSON.stringify(cartItems));


        }

        function totalCost(product) {
            let cartCost = localStorage.getItem("totalCost");
            
            console.log(cartCost);

            if (cartCost != null) {
                cartCost = parseInt(cartCost);
                localStorage.setItem("totalCost", cartCost + product.price);

            } else {
                localStorage.setItem("totalCost", product.price)
            }
            
        }

        function displayCart() {
            let cartItems = localStorage.getItem("productsInCart");
            cartItems = JSON.parse(cartItems);
            let productContainer = document.querySelector(".products");

            if (cartItems && productContainer) {
                productContainer.innerHTML = '';
                Object.values(cartItems).map(item => {
                    productContainer.innerHTML +=
                        `<div class="product">
                        <ion-icon name="close-circle"></ion-icon>
                        <img src="./images/$(item.tag).jpg"></img>
                        <span>$(item.name)</span>
                            </div> `});
            }
        }

        onLoadCartNum();
        displayCart();


    </script>
</body>
</html>